<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <title>Secure PDF QR System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <rect width="40" height="40" rx="8" fill="url(#gradient)" />
                    <path d="M12 12h6v6h-6v-6zm0 10h6v6h-6v-6zm10-10h6v6h-6v-6z" fill="white" />
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                            <stop offset="0%" stop-color="#667eea" />
                            <stop offset="100%" stop-color="#764ba2" />
                        </linearGradient>
                    </defs>
                </svg>
                <h1>Secure PDF QR</h1>
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                <span id="userEmail"></span>
                <button class="btn-secondary" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- Auth Section -->
        <div id="authSection" class="section">
            <div class="auth-container">
                <div class="auth-tabs">
                    <button class="tab-btn active" onclick="showTab('login')">Login</button>
                    <button class="tab-btn" onclick="showTab('register')">Register</button>
                </div>

                <!-- Login Form -->
                <div id="loginTab" class="tab-content active">
                    <h2>Welcome Back</h2>
                    <form onsubmit="login(event)">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="loginEmail" required placeholder="you@example.com">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button type="submit" class="btn-primary">Login</button>
                    </form>
                </div>

                <!-- Register Form -->
                <div id="registerTab" class="tab-content">
                    <h2>Create Account</h2>
                    <form onsubmit="register(event)">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="registerEmail" required placeholder="you@example.com">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="registerPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button type="submit" class="btn-primary">Register</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main App Section -->
        <div id="appSection" class="section" style="display: none;">
            <!-- Navigation -->
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="showSection('upload')">
                    üì§ Upload PDF
                </button>
                <button class="nav-btn" onclick="showSection('scan')">
                    üì∑ Scan QR
                </button>
                <button class="nav-btn" onclick="showSection('documents')">
                    üìÑ My Documents
                </button>
            </div>

            <!-- Upload Section -->
            <div id="uploadSection" class="content-section active">
                <div class="card">
                    <h2>Upload PDF Document</h2>
                    <form onsubmit="uploadPDF(event)" class="upload-form">
                        <div class="file-upload">
                            <input type="file" id="pdfFile" accept=".pdf" required onchange="updateFileName()">
                            <label for="pdfFile" class="file-label">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" />
                                </svg>
                                <span id="fileName">Choose PDF file</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Scan Limit</label>
                            <input type="number" id="scanLimit" required min="1" value="5"
                                placeholder="Maximum scans allowed">
                            <small>Number of times this QR code can be scanned</small>
                        </div>
                        <button type="submit" class="btn-primary">Upload & Generate QR</button>
                    </form>
                </div>

                <!-- Upload Result -->
                <div id="uploadResult" class="card result-card" style="display: none;">
                    <h3>‚úÖ QR Code Generated!</h3>
                    <div class="qr-display">
                        <img id="qrImage" src="" alt="QR Code">
                        <div class="qr-info">
                            <p><strong>Filename:</strong> <span id="resultFilename"></span></p>
                            <p><strong>Unique ID:</strong> <code id="resultUniqueId"></code></p>
                            <p><strong>Scan Limit:</strong> <span id="resultScanLimit"></span></p>
                            <p><strong>Scans Used:</strong> <span id="resultScanCount">0</span></p>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn-primary" onclick="downloadQR()">Download QR Code</button>
                        <button class="btn-secondary" onclick="resetUpload()">Upload Another</button>
                    </div>
                </div>
            </div>

            <!-- Scan Section -->
            <div id="scanSection" class="content-section">
                <div class="card">
                    <h2>Scan QR Code</h2>
                    <div class="scanner-container">
                        <div id="scanner" class="scanner"></div>
                        <div id="scannerPlaceholder" class="scanner-placeholder">
                            <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="3" width="7" height="7" />
                                <rect x="14" y="3" width="7" height="7" />
                                <rect x="3" y="14" width="7" height="7" />
                                <rect x="14" y="14" width="7" height="7" />
                            </svg>
                            <p>Click "Start Scanner" to begin</p>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="startScanBtn" class="btn-primary" onclick="startScanner()">Start Scanner</button>
                        <button id="stopScanBtn" class="btn-secondary" onclick="stopScanner()"
                            style="display: none;">Stop Scanner</button>
                    </div>

                    <!-- Manual Entry -->
                    <div class="manual-entry">
                        <p>Or enter Unique ID manually:</p>
                        <div class="input-group">
                            <input type="text" id="manualUniqueId" placeholder="Enter unique ID">
                            <button class="btn-primary" onclick="verifyManualId()">Verify</button>
                        </div>
                    </div>
                </div>

                <!-- Scan Result -->
                <div id="scanResult" class="card result-card" style="display: none;">
                    <div id="scanSuccess" style="display: none;">
                        <h3>‚úÖ Verification Successful!</h3>
                        <div class="scan-info">
                            <p><strong>Document:</strong> <span id="scanFilename"></span></p>
                            <p><strong>Scans Used:</strong> <span id="scanUsedCount"></span> / <span
                                    id="scanTotalLimit"></span></p>
                        </div>
                        <button class="btn-primary" onclick="downloadPDF()">Download PDF</button>
                    </div>
                    <div id="scanError" style="display: none;">
                        <h3>‚ùå Verification Failed</h3>
                        <p id="scanErrorMessage"></p>
                    </div>
                </div>
            </div>

            <!-- Documents Section -->
            <div id="documentsSection" class="content-section">
                <div class="card">
                    <h2>My Documents</h2>
                    <div id="documentsList" class="documents-list">
                        <p class="loading">Loading documents...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toast" class="toast"></div>
    </div>

    <!-- Include QR Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="/static/app.js"></script>
</body>

</html>